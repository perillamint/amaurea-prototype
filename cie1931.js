const csvdata =
`390.0,0.17842,0.02464,0.79694
395.0,0.17784,0.02509,0.79706
400.0,0.17652,0.02432,0.79915
405.0,0.17504,0.02279,0.80217
410.0,0.17372,0.02185,0.80442
415.0,0.17151,0.02106,0.80744
420.0,0.16935,0.02100,0.80966
425.0,0.16672,0.02188,0.81140
430.0,0.16408,0.02349,0.81243
435.0,0.16074,0.02632,0.81294
440.0,0.15769,0.02925,0.81306
445.0,0.15400,0.03360,0.81240
450.0,0.14977,0.03958,0.81065
455.0,0.14423,0.04951,0.80626
460.0,0.13627,0.06397,0.79976
465.0,0.12634,0.08482,0.78884
470.0,0.11247,0.11750,0.77003
475.0,0.09363,0.16873,0.73765
480.0,0.06929,0.24478,0.68593
485.0,0.04243,0.34386,0.61371
490.0,0.01826,0.46323,0.51851
495.0,0.00486,0.58520,0.40993
500.0,0.00817,0.69130,0.30052
505.0,0.02218,0.77978,0.19804
510.0,0.05030,0.83185,0.11785
515.0,0.09030,0.83993,0.06977
520.0,0.12825,0.83134,0.04040
525.0,0.16931,0.80726,0.02343
530.0,0.20946,0.77699,0.01355
535.0,0.24615,0.74597,0.00788
540.0,0.28316,0.71236,0.00448
545.0,0.31826,0.67915,0.00259
550.0,0.35114,0.64734,0.00152
555.0,0.38361,0.61552,0.00088
560.0,0.41716,0.58232,0.00051
565.0,0.44859,0.55110,0.00030
570.0,0.48088,0.51894,0.00018
575.0,0.51138,0.48851,0.00011
580.0,0.54097,0.45896,0.00007
585.0,0.56937,0.43059,0.00004
590.0,0.59312,0.40685,0.00003
595.0,0.61474,0.38524,0.00002
600.0,0.63396,0.36602,0.00001
605.0,0.65103,0.34896,0.00001
610.0,0.66498,0.33502,0.00001
615.0,0.67638,0.32361,0.00000
620.0,0.68596,0.31404,0.00000
625.0,0.69405,0.30595,0.00000
630.0,0.69977,0.30023,0.00000
635.0,0.70447,0.29553,0.00000
640.0,0.70871,0.29129,0.00000
645.0,0.71259,0.28741,0.00000
650.0,0.71465,0.28535,0.00000
655.0,0.71648,0.28352,0.00000
660.0,0.71824,0.28176,0.00000
665.0,0.71967,0.28033,0.00000
670.0,0.72054,0.27946,0.00000
675.0,0.72115,0.27885,0.00000
680.0,0.72158,0.27842,0.00000
685.0,0.72187,0.27813,0.00000
690.0,0.72205,0.27795,0.00000
695.0,0.72217,0.27783,0.00000
700.0,0.72219,0.27781,0.00000
705.0,0.72219,0.27781,0.00000
710.0,0.72213,0.27787,0.00000
715.0,0.72198,0.27802,0.00000
720.0,0.72182,0.27818,0.00000
725.0,0.72163,0.27837,0.00000
730.0,0.72142,0.27858,0.00000
735.0,0.72120,0.27880,0.00000
740.0,0.72091,0.27909,0.00000
745.0,0.72057,0.27943,0.00000
750.0,0.72022,0.27978,0.00000
755.0,0.71988,0.28012,0.00000
760.0,0.71950,0.28050,0.00000
765.0,0.71915,0.28085,0.00000
770.0,0.71881,0.28119,0.00000
775.0,0.71845,0.28155,0.00000
780.0,0.71807,0.28193,0.00000
785.0,0.71766,0.28234,0.00000
790.0,0.71725,0.28275,0.00000
795.0,0.71681,0.28319,0.00000
800.0,0.71630,0.28370,0.00000
805.0,0.71577,0.28423,0.00000
810.0,0.71523,0.28477,0.00000
815.0,0.71469,0.28531,0.00000
820.0,0.71418,0.28582,0.00000
825.0,0.71373,0.28627,0.00000
830.0,0.71336,0.28664,0.00000`;

const cie1931_data = Papa.parse(csvdata).data;
console.log(cie1931_data);

function get_xyz_intensity(lambda) {
    //Round lambda
    lambda *= Giga;
    lambda = Math.round(lambda / 5) * 5;
    let idx = cie1931_data[cie1931_data.length - 1];

    for(let i = 0; i < cie1931_data.length; i++) {
        let lambda_cur = parseFloat(cie1931_data[i][0]);

        if (lambda_cur >= lambda) {
            idx = cie1931_data[i];
            break;
        }
    }

    return {
        x: parseFloat(idx[1]),
        y: parseFloat(idx[2]),
        z: parseFloat(idx[3])
    };
}
